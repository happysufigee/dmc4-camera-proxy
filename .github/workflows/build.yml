name: Build Camera Proxy

on:
  workflow_dispatch:  # Manual trigger only

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup MSVC
      uses: microsoft/setup-msbuild@v2
    
    - name: Setup Visual Studio environment
      uses: ilammy/msvc-dev-cmd@v1
      with:
        arch: x86  # 32-bit build for DMC4
    
    - name: Build D3D9 Proxy DLL
      run: |
        cl /LD /EHsc /O2 /MD d3d9_proxy.cpp imgui/imgui.cpp imgui/imgui_draw.cpp imgui/imgui_tables.cpp imgui/imgui_widgets.cpp imgui/backends/imgui_impl_dx9.cpp imgui/backends/imgui_impl_win32.cpp /link /DEF:d3d9.def /OUT:d3d9.dll
      shell: cmd
    
    - name: Upload build artifacts
      uses: actions/upload-artifact@v4
      with:
        name: camera-proxy-dll
        path: |
          d3d9.dll
          camera_proxy.ini
          README.md
